<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lms.admin.lwm.mapper.LwmMapper">
    <!-- 수업주차정보 전체 조회-->
    <select id="searchLwmList" resultType="com.lms.admin.lwm.dto.LwmDto">
        <![CDATA[
            SELECT distinct
                c.curriculum_id as curriculumId,
                li.lecture_year as lectureYear,
                clw.week_id as weekId,
                c.curriculum_semester as curriculumSemester,
                c.curriculum_division as curriculumDivision,
                clw.lecture_week as lectureWeek,
                clw.start_date as startDate,
                clw.end_date as endDate,
                clw.makeup_week as makeupWeek
            FROM
                curriculum c
                    JOIN lecture_info li ON c.curriculum_id = li.curriculum_id
                    JOIN curriculum_lecture_week clw ON c.curriculum_id = clw.curriculum_id
            where
                clw.week_id;
        ]]>
    </select>

    <!-- 수업주차정보 년도와 학기별 선택 조회-->
    <select id="searchLwmByYearAndSemester" parameterType="map" resultType="com.lms.admin.lwm.dto.LwmDto">
    <![CDATA[
        SELECT distinct
            c.curriculum_id as curriculumId,
            li.lecture_year as lectureYear,
            clw.week_id as weekId,
            c.curriculum_semester as curriculumSemester,
            c.curriculum_division as curriculumDivision,
            clw.lecture_week as lectureWeek,
            clw.start_date as startDate,
            clw.end_date as endDate,
            clw.makeup_week as makeupWeek
        FROM
            curriculum c
            JOIN lecture_info li ON c.curriculum_id = li.curriculum_id
            JOIN curriculum_lecture_week clw ON c.curriculum_id = clw.curriculum_id
        WHERE
            li.lecture_year = #{lectureYear} AND
            c.curriculum_semester = #{curriculumSemester}
        ]]>
    </select>

    <!-- 수업주차정보 추가 -->
    <!-- 수업주차정보 추가 -->
    <insert id="insertLwm" parameterType="com.lms.admin.lwm.dto.LwmDto">
    <![CDATA[
        INSERT INTO curriculum_lecture_week (curriculum_id, lecture_week, start_date, end_date, makeup_week)
        VALUES (
                   #{curriculumId},
                   #{lectureWeek},
                   #{startDate},
                   #{endDate},
                   #{makeupWeek}
               )
        ]]>
</insert>

    <!-- 수업주차정보 업데이트 -->
    <update id="updateLwm" parameterType="com.lms.admin.lwm.dto.LwmDto">
    <![CDATA[
        UPDATE curriculum_lecture_week
        SET
            lecture_week = #{lectureWeek},
            start_date = #{startDate},
            end_date = #{endDate},
            makeup_week = #{makeupWeek}
        WHERE week_id = #{weekId}
          AND curriculum_id = #{curriculumId}
        ]]>
</update>

    <!-- 수업주차정보 삭제-->
    <delete id="deleteClw">
        DELETE FROM lecutre_schdule WHERE week_id = #{weekId}
    </delete>
    <delete id="deleteLectureTime">
        DELETE FROM lecture_time WHERE week_id = #{weekId}
    </delete>
    <delete id="deleteLwm">
        DELETE FROM curriculum_lecture_week WHERE week_id = #{weekId}
    </delete>


</mapper>